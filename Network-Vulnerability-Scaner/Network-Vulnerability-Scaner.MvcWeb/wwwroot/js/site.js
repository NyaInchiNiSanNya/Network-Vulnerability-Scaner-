document.addEventListener('DOMContentLoaded', function () {

    var vulnRequestElements = document.querySelectorAll('#vulnRequest');

    vulnRequestElements.forEach(function (element) {
        element.addEventListener('click', function (event) {
            GetVulnsFromNvdByPortAsync(event);
        });
    });
});

async function GetVulnsFromNvdByPortAsync(event) {

    var version = event.target.getAttribute("version");

    var service = event.target.getAttribute("service");

    var portData = {
        version: version,
        service: service
    };

    var resp = await fetch('https://localhost:7143/Scan/GetPortVulnerability', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(portData)
    });

    if (resp.ok) {
        var jsonText = await resp.text(); 

        var vulns = JSON.parse(jsonText); 

    } else {

        console.error('Ошибка при выполнении запроса:', resp.status);
    }

    document.getElementById("workPlaceLeftTop").innerHTML = "";

    document.getElementById("leftBack").hidden = true;

    document.getElementById("workplaceL").hidden = false;

    for (var i = 0; i < vulns.nvdReport.length; i++) {

        var report = vulns.nvdReport[i];

        document.getElementById("workPlaceLeftTop").innerHTML += '<span style="font-weight: bold;">' + report.nvdId + '</span>';

        document.getElementById("workPlaceLeftTop").innerHTML += "<br>";

        document.getElementById("workPlaceLeftTop").innerHTML += report.description;

        document.getElementById("workPlaceLeftTop").innerHTML += "<br>";

        document.getElementById("workPlaceLeftTop").innerHTML += '<a href="' + report.reference + '" target="_blank">' + report.reference + '</a>';

        document.getElementById("workPlaceLeftTop").innerHTML += "<br>";
        document.getElementById("workPlaceLeftTop").innerHTML += "<br>";
    }
}
