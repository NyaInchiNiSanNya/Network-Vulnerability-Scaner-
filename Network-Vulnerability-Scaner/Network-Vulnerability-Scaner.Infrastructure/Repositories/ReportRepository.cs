using AutoMapper;
using MongoDB.Driver;
using Network_Vulnerability_Scaner.Application.Interfaces.Repositories;
using Network_Vulnerability_Scaner.Application.Models.Dto;
using Network_Vulnerability_Scaner.Infrastructure.Data;
using Network_Vulnerability_Scaner.Infrastructure.Models;

namespace Network_Vulnerability_Scaner.Infrastructure.Repository
{
    internal class ReportRepository:IReportRepository
    {
        private readonly IMongoCollection<ScanReport> _account;
        private readonly IMapper _mapper;

        public ReportRepository(IReportsDBSettings settings
            , IMongoClient mongoClient
            ,IMapper mapper)
        {
            var x = settings.DatabaseName;
            var database = mongoClient.GetDatabase(settings.DatabaseName);
            _account = database.GetCollection<ScanReport>(settings.ReportsCollectionName);

            _mapper = mapper ?? throw new NullReferenceException(nameof(mapper));
        }

        public async Task AddReportAsync(ScanReportDto reportDto)
        {
            await _account.InsertOneAsync(_mapper.Map<ScanReport>(reportDto));
        }
    }
}
