using AutoMapper;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Network_Vulnerability_Scaner.Application.Interfaces;
using Network_Vulnerability_Scaner.Application.Models.Dto;
using Network_Vulnerability_Scaner.Application.Models.Requests_Responses;
using Network_Vulnerability_Scaner.Application.ServiceFactory;

namespace Network_Vulnerability_Scaner.Controllers
{
    [Route("ReportController")]
    [ApiController]
    public class ReportController : ControllerBase
    {
        private readonly IServiceFactory _serviceFactory;

        public ReportController(IServiceFactory ServiceFactory)
        {
            _serviceFactory = ServiceFactory ?? throw new NullReferenceException(nameof(ServiceFactory));
        }

        [HttpGet("{id:int}")]
        public async Task<IActionResult> GetReportById([FromQuery] String id)
        {
            if (String.IsNullOrEmpty(id))
            {
                return BadRequest();
            }

            return Ok(_serviceFactory
                .CreateMapperService()
                .Map<ScanReportResponse>(await _serviceFactory.CreateReportService().GetReportByIdAsync(id)));
        } 
    }
}
