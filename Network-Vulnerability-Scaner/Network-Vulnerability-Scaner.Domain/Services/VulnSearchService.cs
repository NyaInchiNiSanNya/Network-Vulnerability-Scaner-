using Network_Vulnerability_Scaner.Domain.Interfaces;
using Network_Vulnerability_Scaner.Domain.Entities;
using Network_Vulnerability_Scaner.Domain.Services.Reaquests;

namespace Network_Vulnerability_Scaner.Domain.Services
{
    public class VulnNvdSearchService: IVulnNvdSearchService
    {
        public async Task<List<NvdVulnerability>> GetVulnsFromNvdDbAsync(Port port)
        {
            var splitVersion = port.Version.Split();

            var totalResult= new List<NvdVulnerability>();
            
            var requestResult=new List<NvdVulnerability>();

            var requestString = String.Empty;

            foreach (var versionPart in splitVersion)
            { 
                requestString = requestString + " " + versionPart;

                requestResult= await new NvdRequest().RequestToNvd(requestString);
                
                if (requestResult.Count==0)
                {
                    break;
                }
                
                totalResult=requestResult;
            }

            return totalResult;
        }
    }
}
